<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Gone Fishing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=2caa0aad044a3b83b4d652639794266fe94766b9">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Gone Fishing | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Gone Fishing" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Skipping I skipped Advent of Code Day Five for now. I didn’t immediately have a strategy for the solution and looked ahead to Day Six since I was behind a bit. Good News! Going Fishing!" />
<meta property="og:description" content="Skipping I skipped Advent of Code Day Five for now. I didn’t immediately have a strategy for the solution and looked ahead to Day Six since I was behind a bit. Good News! Going Fishing!" />
<link rel="canonical" href="https://assumeforsimplicity.com/detour/2021/12/06/gonefishing.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/detour/2021/12/06/gonefishing.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-06T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gone Fishing" />
<script type="application/ld+json">
{"description":"Skipping I skipped Advent of Code Day Five for now. I didn’t immediately have a strategy for the solution and looked ahead to Day Six since I was behind a bit. Good News! Going Fishing!","headline":"Gone Fishing","dateModified":"2021-12-06T09:11:34+00:00","datePublished":"2021-12-06T09:11:34+00:00","url":"https://assumeforsimplicity.com/detour/2021/12/06/gonefishing.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/detour/2021/12/06/gonefishing.html"},"author":{"@type":"Person","name":"jr101dallas"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Gone Fishing</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">6 December 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="skipping">Skipping</h1>
<p>I skipped <a href="https://adventofcode.com/2021">Advent of Code</a> Day Five for now. I didn’t immediately have a strategy for the solution and looked ahead to Day Six since I was behind a bit. Good News! Going Fishing!</p>

<h2 id="data-modeling">Data Modeling</h2>
<p>Data transformations are super easy in SQL. You just need to set up the relationships. For instance, here are the table representations of the fish population, fish lifecycle, and fish reproduction.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span>
<span class="k">into</span> <span class="o">#</span><span class="n">population</span>
<span class="k">from</span> <span class="p">(</span>
	<span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="p">...</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span> <span class="n">t</span><span class="p">(</span><span class="n">fish</span><span class="p">)</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">into</span> <span class="o">#</span><span class="n">lifecycle</span>
<span class="k">from</span> <span class="p">(</span>
	<span class="k">VALUES</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span> <span class="n">t</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">nextAge</span><span class="p">,</span> <span class="n">newFish</span><span class="p">)</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">into</span> <span class="o">#</span><span class="n">newfish</span>
<span class="k">from</span> <span class="p">(</span>
	<span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="p">)</span> <span class="n">t</span><span class="p">(</span><span class="n">newfish</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
</code></pre></div></div>

<p>With those quick data models, the solution to both puzzle one and puzzle two look like this.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DECLARE</span> <span class="o">@</span><span class="n">todayPop</span> <span class="n">TableRowNumAndBigInt</span><span class="p">,</span>
	<span class="o">@</span><span class="n">tomorrowPop</span> <span class="n">TableRowNumAndBigInt</span><span class="p">,</span>
	<span class="o">@</span><span class="n">days</span> <span class="nb">BIGINT</span> <span class="o">=</span> <span class="mi">255</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">@</span><span class="n">tomorrowPop</span> <span class="p">(</span><span class="n">rowNum</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="n">oa</span><span class="p">.</span><span class="n">age</span><span class="p">,</span> <span class="n">l</span><span class="p">.</span><span class="n">nextAge</span><span class="p">),</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">fish</span><span class="p">)</span>
<span class="k">FROM</span> <span class="o">#</span><span class="n">population</span> <span class="n">p</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="o">#</span><span class="n">lifecycle</span> <span class="n">l</span> <span class="k">ON</span> <span class="n">p</span><span class="p">.</span><span class="n">fish</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="n">age</span>
<span class="k">OUTER</span> <span class="n">APPLY</span><span class="p">(</span><span class="k">SELECT</span> <span class="n">age</span> <span class="k">FROM</span> <span class="o">#</span><span class="n">newfish</span> <span class="n">n</span> <span class="k">WHERE</span> <span class="n">n</span><span class="p">.</span><span class="n">newfish</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="n">newFish</span><span class="p">)</span> <span class="n">oa</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">fish</span><span class="p">,</span> <span class="n">l</span><span class="p">.</span><span class="n">nextAge</span><span class="p">,</span> <span class="n">oa</span><span class="p">.</span><span class="n">age</span>

<span class="n">WHILE</span> <span class="o">@</span><span class="n">days</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">BEGIN</span>
	<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">@</span><span class="n">todayPop</span>
	<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">@</span><span class="n">tomorrowPop</span>

	<span class="k">DELETE</span> <span class="o">@</span><span class="n">tomorrowPop</span>

	<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">@</span><span class="n">tomorrowPop</span> <span class="p">(</span><span class="n">rowNum</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
	<span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="n">oa</span><span class="p">.</span><span class="n">age</span><span class="p">,</span> <span class="n">l</span><span class="p">.</span><span class="n">nextAge</span><span class="p">),</span> <span class="k">SUM</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
	<span class="k">FROM</span> <span class="o">@</span><span class="n">todayPop</span> <span class="n">p</span>
	<span class="k">INNER</span> <span class="k">JOIN</span> <span class="o">#</span><span class="n">lifecycle</span> <span class="n">l</span> <span class="k">ON</span> <span class="n">p</span><span class="p">.</span><span class="n">rowNum</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="n">age</span>
	<span class="k">OUTER</span> <span class="n">APPLY</span><span class="p">(</span><span class="k">SELECT</span> <span class="n">age</span> <span class="k">FROM</span> <span class="o">#</span><span class="n">newfish</span> <span class="n">n</span> <span class="k">WHERE</span> <span class="n">n</span><span class="p">.</span><span class="n">newfish</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="n">newFish</span><span class="p">)</span> <span class="n">oa</span>
	<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">rowNum</span><span class="p">,</span> <span class="n">l</span><span class="p">.</span><span class="n">nextAge</span><span class="p">,</span> <span class="n">oa</span><span class="p">.</span><span class="n">age</span>

	<span class="k">SELECT</span> <span class="o">@</span><span class="n">days</span> <span class="o">=</span> <span class="o">@</span><span class="n">days</span> <span class="o">-</span> <span class="mi">1</span>
	<span class="k">DELETE</span> <span class="o">@</span><span class="n">todayPop</span>
<span class="k">END</span>


<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="o">@</span><span class="n">tomorrowPop</span>

<span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<span class="k">FROM</span> <span class="o">@</span><span class="n">tomorrowPop</span>
</code></pre></div></div>

<p>As a quick reminder, the custom type used above just looks like this.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TYPE</span> <span class="n">TableRowNumAndBigInt</span> <span class="k">AS</span> <span class="k">TABLE</span> <span class="p">(</span> <span class="n">rowNum</span> <span class="nb">BIGINT</span><span class="p">,</span> <span class="n">val</span> <span class="nb">BIGINT</span> <span class="p">);</span>
<span class="k">GO</span>
</code></pre></div></div>

<h2 id="watch-out">Watch Out</h2>
<p>The count limiter above is 255 for the 256 fish generations, and was 79 for the 80 generations. Also, I didn’t originally do the group by and sum, and had a straight fish population to new fish population select in the middle. It ran for 7 hours while I slept before I cancelled it….</p>



  <small>tags: <em>code</em> - <em>sql</em> - <em>fun</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/detour/2021/12/05/playing-catchup.html">&#8672;&nbsp;Playing Catchup</a>
      
    </p>
    <p>
      
      <a href="/detour/2021/12/07/well-rested.html">Well Rested&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>