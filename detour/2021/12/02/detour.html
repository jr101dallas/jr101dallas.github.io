<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Detour</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Detour | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Detour" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Advent of Code Working again on Advent of Code puzzles. The puzzles again suggested data processing to me, so again I cooked up SQL solutions." />
<meta property="og:description" content="Advent of Code Working again on Advent of Code puzzles. The puzzles again suggested data processing to me, so again I cooked up SQL solutions." />
<link rel="canonical" href="https://assumeforsimplicity.com/detour/2021/12/02/detour.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/detour/2021/12/02/detour.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-02T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Detour" />
<script type="application/ld+json">
{"description":"Advent of Code Working again on Advent of Code puzzles. The puzzles again suggested data processing to me, so again I cooked up SQL solutions.","headline":"Detour","dateModified":"2021-12-02T09:11:34+00:00","datePublished":"2021-12-02T09:11:34+00:00","url":"https://assumeforsimplicity.com/detour/2021/12/02/detour.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/detour/2021/12/02/detour.html"},"author":{"@type":"Person","name":"jr101dallas"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Detour</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">2 December 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="advent-of-code">Advent of Code</h1>
<p>Working again on <a href="https://adventofcode.com/2021">Advent of Code</a> puzzles. The puzzles again suggested data processing to me, so again I cooked up SQL solutions.</p>

<h2 id="submarine-pilot">Submarine Pilot</h2>
<p>This puzzle is a sequence of values describing motion in two dimensions, a good twist on our previous single scalar variation. With a little find and replace, I prettied up the values into two columns for insert, the direction and the scalar.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">#</span><span class="n">instructions</span> 
<span class="p">(</span><span class="n">rowNumber</span> <span class="nb">BIGINT</span> <span class="k">IDENTITY</span><span class="p">,</span> <span class="n">direction</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">scalar</span> <span class="nb">BIGINT</span><span class="p">)</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">instructions</span> <span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">scalar</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">direction</span><span class="p">,</span> <span class="n">scalar</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'forward'</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'down'</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'forward'</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'down'</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
        <span class="p">...</span>
        <span class="p">(</span><span class="s1">'forward'</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="p">)</span> <span class="n">t</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">scalar</span><span class="p">);</span>
</code></pre></div></div>

<p>Again using the Common Table Expression (CTE) and the case statements allows for separate data streams (columns) and a little preprocessing for up versus down so that we can just straight sum things. Technically the answer is the two values multiplied together but that was beautiful and easy too with <code class="language-plaintext highlighter-rouge">SELECT 1895 * 1067</code> to do my math for me.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span> <span class="n">cte</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span> 
        <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">'forward'</span> <span class="k">THEN</span> <span class="n">scalar</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span> <span class="k">AS</span> <span class="k">forward</span><span class="p">,</span>
        <span class="k">CASE</span> 
            <span class="k">WHEN</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">'up'</span> <span class="k">THEN</span> <span class="n">scalar</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">WHEN</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">'down'</span> <span class="k">THEN</span> <span class="n">scalar</span>
        <span class="k">END</span> <span class="k">AS</span> <span class="n">depth</span>
    <span class="k">FROM</span> <span class="o">#</span><span class="n">instructions</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="k">forward</span><span class="p">)</span> <span class="k">AS</span> <span class="n">hDist</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span> <span class="k">AS</span> <span class="n">vdist</span>
<span class="k">FROM</span> <span class="n">cte</span>
</code></pre></div></div>

<p>But, of course, that was only puzzle number one and it turns out everything was wrong!</p>

<h2 id="twist-again">Twist Again</h2>
<p>Luckily, the second puzzle isn’t that much more difficult than the first. It’s another turn of the screw on the theme.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span> <span class="n">cte</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">rowNumber</span><span class="p">,</span>
        <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">'forward'</span> <span class="k">THEN</span> <span class="n">scalar</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span> <span class="k">AS</span> <span class="k">forward</span><span class="p">,</span>
        <span class="k">CASE</span> 
            <span class="k">WHEN</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">'up'</span> <span class="k">THEN</span> <span class="n">scalar</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">WHEN</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">'down'</span> <span class="k">THEN</span> <span class="n">scalar</span>
        <span class="k">END</span> <span class="k">AS</span> <span class="n">aim</span>
    <span class="k">FROM</span> <span class="o">#</span><span class="n">instructions</span>
<span class="p">)</span>
<span class="p">,</span> <span class="n">cte2</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">rowNumber</span><span class="p">,</span> <span class="k">forward</span><span class="p">,</span> <span class="n">aim</span><span class="p">,</span>
        <span class="k">sum</span><span class="p">(</span><span class="k">forward</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">rowNumber</span> <span class="k">ROWS</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="n">PRECEDING</span> <span class="k">AND</span> <span class="k">CURRENT</span> <span class="k">ROW</span><span class="p">)</span>  <span class="k">AS</span> <span class="n">hDist</span><span class="p">,</span> 
        <span class="n">coalesce</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">aim</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">rowNumber</span> <span class="k">ROWS</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="n">PRECEDING</span> <span class="k">AND</span> <span class="k">CURRENT</span> <span class="k">ROW</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">runningAim</span>
    <span class="k">FROM</span> <span class="n">cte</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> 
    <span class="k">forward</span> <span class="o">*</span> <span class="n">runningAim</span> <span class="k">AS</span> <span class="n">depthChange</span><span class="p">,</span> 
    <span class="k">sum</span><span class="p">(</span><span class="k">forward</span> <span class="o">*</span> <span class="n">runningAim</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">rowNumber</span> <span class="k">ROWS</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="n">PRECEDING</span> <span class="k">AND</span> <span class="k">CURRENT</span> <span class="k">ROW</span><span class="p">)</span> <span class="k">AS</span> <span class="n">runningDepth</span>
<span class="k">FROM</span> <span class="n">cte2</span>
</code></pre></div></div>

<p>In this case, we keep the first cte the same, sorting out our data streams into axes and multiplying by negative one for motion along the axis in the opposite direction. The second CTE is really just the outer select from the previous puzzle, the reason it looks different is that I wanted to be able to see the row by row values for sanity checking. The outer select then just carries forward my hDist values from the second CTE, but the further calculations of multiplying the motion by the aim and setting up that running total for the depth get worked in finally. And, again, the last row has my values to multiply together to get my answer.</p>

<p>I’m definitely curious what the next puzzle looks like to see whether this trend continues or something different crops up.</p>




  <small>tags: <em>code</em> - <em>sql</em> - <em>fun</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/detour/2021/12/01/advent-of-code.html">&#8672;&nbsp;Advent of Code</a>
      
    </p>
    <p>
      
      <a href="/detour/2021/12/03/new-puzzle.html">New Puzzle&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>