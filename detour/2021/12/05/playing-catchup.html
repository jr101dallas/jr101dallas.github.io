<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Playing Catchup</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Playing Catchup | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Playing Catchup" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Behind On Puzzles After totally switching gears and solving Day Three in two different languages because I was not seeing a bug in my SQL data types, I’m ready to try making some rapid progress on puzzles but I think I’m looking at more of a data pipeline problem than anything else in Day Four." />
<meta property="og:description" content="Behind On Puzzles After totally switching gears and solving Day Three in two different languages because I was not seeing a bug in my SQL data types, I’m ready to try making some rapid progress on puzzles but I think I’m looking at more of a data pipeline problem than anything else in Day Four." />
<link rel="canonical" href="https://assumeforsimplicity.com/detour/2021/12/05/playing-catchup.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/detour/2021/12/05/playing-catchup.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-05T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Playing Catchup" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"jr101dallas"},"description":"Behind On Puzzles After totally switching gears and solving Day Three in two different languages because I was not seeing a bug in my SQL data types, I’m ready to try making some rapid progress on puzzles but I think I’m looking at more of a data pipeline problem than anything else in Day Four.","headline":"Playing Catchup","dateModified":"2021-12-05T09:11:34+00:00","url":"https://assumeforsimplicity.com/detour/2021/12/05/playing-catchup.html","datePublished":"2021-12-05T09:11:34+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/detour/2021/12/05/playing-catchup.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Playing Catchup</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">5 December 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="behind-on-puzzles">Behind On Puzzles</h1>
<p>After totally switching gears and solving Day Three in two different languages because I was not seeing a bug in my SQL data types, I’m ready to try making some rapid progress on puzzles but I think I’m looking at more of a data pipeline problem than anything else in Day Four.</p>

<p>The puzzle is presented as bingo cards, and the first question is which will win.</p>

<h2 id="data">Data</h2>
<p>Before I was doing some regex replace formatting of the input data just to make the insert statements easy, but now with two data sets in the same page/link I definitely don’t mind messing around with the data in some preprocessing steps. Sometimes that just saves a ton of code. But, in this case I’m thinking that the preprocessing may be extensive enough that I need to include that logic in my solution.</p>

<p>Data set one is a sequence of numbers to be called by the bingo caller. It’s just the first line so I’m manually copying that into a separate file. I’m working in vscode, so regular expression (regex) flavors may vary but a regex replace of <code class="language-plaintext highlighter-rouge">(\d+),?</code> with <code class="language-plaintext highlighter-rouge">($1),\n</code> gives me a nice result to just paste into the body of my VALUES atatement for my insert.</p>

<p>Data set two is lots more fun. We’ve got 5 x 5 grids of numbers with blank lines between. I’m hesitating here because what I have in mind would be super simple in C# by just incrementing a counter whenver I see a blank line in my file processing loop. Actually…. LOL. It’s been a long time since I’ve gotten to be creative with calculated columns. Technically, table definitions are a lot like objects and class definitions. I had to do a little testing to make sure I had the edge cases right but I’m going to just do a straight insert of the bingo board rows into this table.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">BingoBoards</span> <span class="p">(</span><span class="n">rowNumber</span> <span class="nb">BIGINT</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> 
	<span class="n">board</span> <span class="k">AS</span> <span class="p">(</span><span class="n">rowNumber</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">rowNumber</span> <span class="o">%</span> <span class="mi">5</span><span class="p">))</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> 
	<span class="n">boardRow</span> <span class="k">AS</span> <span class="p">((</span><span class="n">rowNumber</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> 
	<span class="n">b</span> <span class="nb">BIGINT</span><span class="p">,</span> 
	<span class="n">i</span> <span class="nb">BIGINT</span><span class="p">,</span> 
	<span class="n">n</span> <span class="nb">BIGINT</span><span class="p">,</span> 
	<span class="k">g</span> <span class="nb">BIGINT</span><span class="p">,</span> 
	<span class="n">o</span> <span class="nb">BIGINT</span><span class="p">)</span>
</code></pre></div></div>

<p>And that will give me row ordering if I need it and it gives me board numbering, both are 0 based the way I set it up. That means that my preprocessing is just this regex replace of <code class="language-plaintext highlighter-rouge">^\s?(\d{1,2})\s{1,2}(\d{1,2})\s{1,2}(\d{1,2})\s{1,2}(\d{1,2})\s{1,2}(\d{1,2})</code> with <code class="language-plaintext highlighter-rouge">($1,$2,$3,$4,$5),</code> to get the insert nicely formatted.</p>

<p>Now that I have a table of rows, I need a table of columns as we so I can check both directions easily. I’m not thrilled with this answer, but there are five of these.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="n">TransposeB</span><span class="p">(</span><span class="o">@</span><span class="n">boardNum</span> <span class="nb">BIGINT</span><span class="p">)</span>
<span class="k">RETURNS</span> <span class="k">TABLE</span>
<span class="k">RETURN</span>
<span class="k">SELECT</span>    
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">AS</span> <span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">AS</span> <span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">AS</span> <span class="n">n</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">AS</span> <span class="k">g</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">AS</span> <span class="n">o</span>
<span class="k">FROM</span>  
<span class="p">(</span>
  <span class="k">SELECT</span> <span class="n">boardRow</span><span class="p">,</span> <span class="n">b</span> 
  <span class="k">FROM</span> <span class="n">bingoboards</span>
  <span class="k">WHERE</span> <span class="n">board</span> <span class="o">=</span> <span class="o">@</span><span class="n">boardNum</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">SourceTable</span>  
<span class="n">PIVOT</span>  
<span class="p">(</span>  
  <span class="k">SUM</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  
  <span class="k">FOR</span> <span class="n">boardRow</span> <span class="k">IN</span> <span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">])</span>  
<span class="p">)</span> <span class="k">AS</span> <span class="n">PivotTable</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></div>

<p>With those I don’t have to do dynamic SQL to do this even though it’s redundant. Now at least I can loop and transform my columns to rows for my query.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DECLARE</span> <span class="o">@</span><span class="n">board</span> <span class="nb">BIGINT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">WHILE</span> <span class="o">@</span><span class="n">board</span> <span class="o">&lt;</span> <span class="mi">100</span>
<span class="k">BEGIN</span>
	<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">BingoBoardsCols</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="k">g</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
	<span class="k">SELECT</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="k">g</span><span class="p">,</span> <span class="n">o</span>
	<span class="k">FROM</span> <span class="p">(</span>
	<span class="k">SELECT</span> <span class="mi">1</span> <span class="k">AS</span> <span class="n">sort</span><span class="p">,</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">TransposeB</span><span class="p">(</span><span class="o">@</span><span class="n">board</span><span class="p">)</span>
	<span class="k">UNION</span>
	<span class="k">SELECT</span> <span class="mi">2</span> <span class="k">AS</span> <span class="n">sort</span><span class="p">,</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">TransposeI</span><span class="p">(</span><span class="o">@</span><span class="n">board</span><span class="p">)</span>
	<span class="k">UNION</span>
	<span class="k">SELECT</span> <span class="mi">3</span> <span class="k">AS</span> <span class="n">sort</span><span class="p">,</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">TransposeN</span><span class="p">(</span><span class="o">@</span><span class="n">board</span><span class="p">)</span>
	<span class="k">UNION</span>
	<span class="k">SELECT</span> <span class="mi">4</span> <span class="k">AS</span> <span class="n">sort</span><span class="p">,</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">TransposeG</span><span class="p">(</span><span class="o">@</span><span class="n">board</span><span class="p">)</span>
	<span class="k">UNION</span>
	<span class="k">SELECT</span> <span class="mi">5</span> <span class="k">AS</span> <span class="n">sort</span><span class="p">,</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">TransposeO</span><span class="p">(</span><span class="o">@</span><span class="n">board</span><span class="p">)</span>
	<span class="p">)</span> <span class="n">t</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="k">g</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
	<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">sort</span>

	<span class="k">SELECT</span> <span class="o">@</span><span class="n">board</span> <span class="o">=</span> <span class="o">@</span><span class="n">board</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">END</span>
</code></pre></div></div>

<h2 id="query">Query</h2>
<p>Now that I’ve got my data easy, there’s just a little more to do. I insert five of these into a temp table. The b.b has to be changed for the other four, b.i, b.n, b.g, b.o. Then select the temp table ordered by LastSequence and first row is the board that wins first and the sequence number it’s called on. Note the sequence number!</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">TOP</span> <span class="mi">5</span> <span class="n">b</span><span class="p">.</span><span class="n">RowOrCol</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">board</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rowNumber</span><span class="p">)</span> <span class="n">LastSequence</span>
<span class="k">FROM</span> <span class="n">BingoRowsAndColumns</span> <span class="n">b</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="o">##</span><span class="n">sequence</span> <span class="n">s</span> <span class="k">ON</span> <span class="n">b</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">val</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">b</span><span class="p">.</span><span class="n">RowOrCol</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">board</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">MAX</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rowNumber</span><span class="p">)</span>
</code></pre></div></div>

<p>Now that we know which board wins first, and the sequence number where it wins, we can use this query to get the number called on that sequence number and sum the rest of the numbers after it to multiply it against.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DECLARE</span> <span class="o">@</span><span class="n">board</span> <span class="nb">BIGINT</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>

<span class="k">select</span> <span class="n">b</span>
<span class="k">INTO</span> <span class="o">#</span><span class="n">winningBoard</span>
<span class="k">from</span> <span class="n">BingoBoards</span>
<span class="k">where</span> <span class="n">board</span> <span class="o">=</span> <span class="o">@</span><span class="n">board</span>
<span class="k">UNION</span>
<span class="k">select</span> <span class="n">i</span>
<span class="k">from</span> <span class="n">BingoBoards</span>
<span class="k">where</span> <span class="n">board</span> <span class="o">=</span> <span class="o">@</span><span class="n">board</span>
<span class="k">UNION</span>
<span class="k">select</span> <span class="n">n</span>
<span class="k">from</span> <span class="n">BingoBoards</span>
<span class="k">where</span> <span class="n">board</span> <span class="o">=</span> <span class="o">@</span><span class="n">board</span>
<span class="k">UNION</span>
<span class="k">select</span> <span class="k">g</span>
<span class="k">from</span> <span class="n">BingoBoards</span>
<span class="k">where</span> <span class="n">board</span> <span class="o">=</span> <span class="o">@</span><span class="n">board</span>
<span class="k">UNION</span>
<span class="k">select</span> <span class="n">o</span>
<span class="k">from</span> <span class="n">BingoBoards</span>
<span class="k">where</span> <span class="n">board</span> <span class="o">=</span> <span class="o">@</span><span class="n">board</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="o">#</span><span class="n">winningBoard</span> <span class="n">b</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="o">##</span><span class="n">sequence</span> <span class="n">s</span> <span class="k">ON</span> <span class="n">b</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">val</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">s</span><span class="p">.</span><span class="n">rowNumber</span>
</code></pre></div></div>

<p>The sequence number you noted earlier has the value to multiply by, and the rest of the rows with greater sequence numbers are the ones to sum and multiply by the last number called.</p>

<h2 id="puzzle-two">Puzzle Two</h2>
<p>Now I think I have a problem. Getting the least or the last is super easy. But for puzzle two I don’t need the last called number on the last card. What I need is the first win for each card and get the last of those. I haven’t got a solution there yet and it’s time for bed.</p>



  <small>tags: <em>code</em> - <em>sql</em> - <em>fun</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/detour/2021/12/04/checking-work.html">&#8672;&nbsp;Debugging</a>
      
    </p>
    <p>
      
      <a href="/detour/2021/12/06/gonefishing.html">Gone Fishing&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>