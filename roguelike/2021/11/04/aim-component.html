<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Aim Component</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=2caa0aad044a3b83b4d652639794266fe94766b9">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Aim Component | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Aim Component" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="First Component The first of my planned steps involves my first real Component. Calling it Aim is what I’m thinking so far, but we’ll find out whether that sticks." />
<meta property="og:description" content="First Component The first of my planned steps involves my first real Component. Calling it Aim is what I’m thinking so far, but we’ll find out whether that sticks." />
<link rel="canonical" href="https://assumeforsimplicity.com/roguelike/2021/11/04/aim-component.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/roguelike/2021/11/04/aim-component.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-04T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Aim Component" />
<script type="application/ld+json">
{"description":"First Component The first of my planned steps involves my first real Component. Calling it Aim is what I’m thinking so far, but we’ll find out whether that sticks.","headline":"Aim Component","dateModified":"2021-11-04T09:11:34+00:00","datePublished":"2021-11-04T09:11:34+00:00","url":"https://assumeforsimplicity.com/roguelike/2021/11/04/aim-component.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/roguelike/2021/11/04/aim-component.html"},"author":{"@type":"Person","name":"jr101dallas"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Aim Component</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">4 November 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="first-component">First Component</h1>
<p>The first of my planned steps involves my first real Component. Calling it Aim is what I’m thinking so far, but we’ll find out whether that sticks.</p>

<ul>
  <li>a Component with a base targeting value, initially added by default to all Entity instances with the same value and used for determining success in Target</li>
</ul>

<p>Breaking down my work a bit further gives me some more manageable steps:</p>

<ol>
  <li>create the Aim component</li>
  <li>give Aim an int that counts for the base value, hardcoded value to start</li>
  <li>add it to newly created Entity instances by default for now</li>
  <li>add logic to Target to determine targeting success</li>
  <li>add logic to Target to grab a source Entity Aim Component and take into account the base aiming int</li>
</ol>

<h2 id="ready-go">Ready, Go</h2>
<p>Codewise, Aim is a copy paste from Component to start. I don’t have a reason to inherit from Component but I want to implement IComponent for when I pass it into the Entity components dictionary. Adding BaseAim is the main differentiator, readonly for now. And of course tests.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Aim</span> <span class="p">:</span> <span class="n">IComponent</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">BaseAim</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
    <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultAimIsIComponent</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">aim</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Aim</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">IsTrue</span><span class="p">(</span><span class="n">aim</span> <span class="k">is</span> <span class="n">IComponent</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultAimBaseAimIsFive</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">aim</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Aim</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="n">aim</span><span class="p">.</span><span class="n">BaseAim</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Where to add Aim to new Entity instances is maybe a little debatable. I thought about plunking it right into Entity but I’m really thinking that’s too much built in. EntityFactory is where I’ll eventually be generating piles of different kinds of Entity so that’s where the Component add needs to happen. It’ll probably eventually be farmed out to some other class, but for now I’m just going to plunk my code right straight into EntityFactory. And of course there’s a test.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="n">Entity</span> <span class="nf">GetEntity</span><span class="p">(</span><span class="kt">int</span> <span class="n">lastEntityId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">newEntityId</span> <span class="p">=</span> <span class="p">++</span><span class="n">lastEntityId</span><span class="p">;</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">newEntityId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has entered play!"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">newEntity</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Entity</span><span class="p">(){</span><span class="n">Id</span> <span class="p">=</span> <span class="n">newEntityId</span><span class="p">};</span>
            <span class="n">newEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Aim"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Aim</span><span class="p">());</span>
            <span class="k">return</span> <span class="n">newEntity</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">GetEntityDefaultsAimComponent</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">ef</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EntityFactory</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">entity</span> <span class="p">=</span> <span class="n">ef</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"Aim"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">defaultAim</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Physics</span><span class="p">.</span><span class="n">Components</span><span class="p">.</span><span class="n">Aim</span><span class="p">),</span> <span class="n">defaultAim</span><span class="p">.</span><span class="nf">GetType</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Assert</span><span class="p">.</span><span class="nf">Fail</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="halfway">Halfway</h2>
<p>The only work left now is all in Target. I’m going to work in a random number generator and just check if it’s over 50 out of 100 I think. Nice and simple and it gets me mostly where I’m going. The major problem is going to be what to do with testing. I may have to cheat for now and wait till I have a component pulled in for good random number functionality. I think GoRogue has a testing “random number generator” that produces a constant, for instance.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">private</span> <span class="n">Random</span> <span class="n">_rand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntity</span><span class="p">(</span><span class="n">Entity</span> <span class="n">originEntity</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">targetEntity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">50</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">removeEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">removeEntityId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has been removed from play!"</span><span class="p">);</span>
                <span class="n">_unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">removeEntityId</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>And now my test randomly fails!</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntityRemovedFromPlay</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">originEntity</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">targetEntity</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">tEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>

            <span class="n">unv</span><span class="p">.</span><span class="n">inf</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">TargetEntity</span><span class="p">(</span><span class="n">originEntity</span><span class="p">,</span> <span class="n">targetEntity</span><span class="p">);</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">IsFalse</span><span class="p">(</span><span class="n">unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">tEntityId</span><span class="p">,</span> <span class="k">out</span> <span class="n">_</span><span class="p">),</span> <span class="s">"Targeted Entity still exists."</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Well, the expected result is good even if it means there’s more work still to be done that I hadn’t worked into my planning steps. So now the last thing is to work in using the BaseAim from the Component.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntity</span><span class="p">(</span><span class="n">Entity</span> <span class="n">originEntity</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">targetEntity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">originEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"Aim"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">aimIComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">aimComponent</span> <span class="p">=</span> <span class="p">(</span><span class="n">Aim</span><span class="p">)</span><span class="n">aimIComponent</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">aimModifier</span> <span class="p">=</span> <span class="n">aimComponent</span><span class="p">.</span><span class="n">BaseAim</span><span class="p">;</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">_rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">)</span> <span class="p">+</span> <span class="n">aimModifier</span> <span class="p">&gt;</span> <span class="m">50</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">removeEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">removeEntityId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has been removed from play!"</span><span class="p">);</span>
                <span class="n">_unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">removeEntityId</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>That leaves me with my randomly failing test, and some magic strings, and some other refactoring that I need to do, but the main hunk of code for this work item is complete! Now for the <code class="language-plaintext highlighter-rouge">dotnet test</code> a few last times to make sure it’s still actually possible for all my tests to pass, then my <code class="language-plaintext highlighter-rouge">git status</code> routine and push.</p>



  <small>tags: <em>code</em> - <em>aim</em> - <em>component</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/roguelike/2021/11/03/differentiate.html">&#8672;&nbsp;Differentiate</a>
      
    </p>
    <p>
      
      <a href="/roguelike/2021/11/05/testing-random.html">Testing Random&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>