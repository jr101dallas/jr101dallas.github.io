<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Back To HP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=2caa0aad044a3b83b4d652639794266fe94766b9">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Back To HP | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Back To HP" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Defense Back on the coding for Offense and Defense. I stopped pretty suddenly in the middle before, so I didn’t have any tests on Defense even though I’d popped in BaseHealth. Also, I’d thrown in BaseDamage in Office and hadn’t put a test on it, so here are those." />
<meta property="og:description" content="Defense Back on the coding for Offense and Defense. I stopped pretty suddenly in the middle before, so I didn’t have any tests on Defense even though I’d popped in BaseHealth. Also, I’d thrown in BaseDamage in Office and hadn’t put a test on it, so here are those." />
<link rel="canonical" href="https://assumeforsimplicity.com/roguelike/2021/11/15/back-to-hp.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/roguelike/2021/11/15/back-to-hp.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-15T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Back To HP" />
<script type="application/ld+json">
{"description":"Defense Back on the coding for Offense and Defense. I stopped pretty suddenly in the middle before, so I didn’t have any tests on Defense even though I’d popped in BaseHealth. Also, I’d thrown in BaseDamage in Office and hadn’t put a test on it, so here are those.","headline":"Back To HP","dateModified":"2021-11-15T09:11:34+00:00","datePublished":"2021-11-15T09:11:34+00:00","url":"https://assumeforsimplicity.com/roguelike/2021/11/15/back-to-hp.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/roguelike/2021/11/15/back-to-hp.html"},"author":{"@type":"Person","name":"jr101dallas"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Back To HP</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">15 November 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="defense">Defense</h1>
<p>Back on the coding for Offense and Defense. I stopped pretty suddenly in the middle before, so I didn’t have any tests on Defense even though I’d popped in BaseHealth. Also, I’d thrown in BaseDamage in Office and hadn’t put a test on it, so here are those.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultDefenseIsIComponent</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">def</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Defense</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">IsTrue</span><span class="p">(</span><span class="n">def</span> <span class="k">is</span> <span class="n">IComponent</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultDefenseBaseAimIsFive</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">def</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Defense</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="n">def</span><span class="p">.</span><span class="n">BaseHealth</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultOffenseBaseDamageIsFive</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">off</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Offense</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="n">off</span><span class="p">.</span><span class="n">BaseDamage</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Still basic tests, based on current hardcoding. When I start doing more interesting things with the classes, the tests will keep me honest and aware of what I’m changing and whether I meant to change it.</p>

<h2 id="changes">Changes</h2>
<p>I’m suddenly feeling like I planned this very badly. I totaly forgot that I’m going to want a CurrentHealth as well as a BaseHealth. That does add another test in DefenseTests. But then I’m ready to actually add the damage dealing logic in Target. It will mean thhat I have at least one test that will fail afterward. Right now, just targeting an Entity is removing it from play. Once I’m finished it will only have a reduction in CurrentHealth unless I change up some numbers.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntity</span><span class="p">(</span><span class="n">Entity</span> <span class="n">originEntity</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">targetEntity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">targetEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">ComponentType</span><span class="p">.</span><span class="n">Defense</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">defenseIComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">originEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">ComponentType</span><span class="p">.</span><span class="n">Offense</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">offenseIComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">aimMods</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">originEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">ComponentType</span><span class="p">.</span><span class="n">Inventory</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">inventoryIComponent</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">aimMods</span> <span class="p">=</span> <span class="nf">GetAimModifiers</span><span class="p">(</span><span class="n">inventoryIComponent</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">defenseComponent</span> <span class="p">=</span> <span class="p">(</span><span class="n">Defense</span><span class="p">)</span><span class="n">defenseIComponent</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">offenseComponent</span> <span class="p">=</span> <span class="p">(</span><span class="n">Offense</span><span class="p">)</span><span class="n">offenseIComponent</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">aimModifier</span> <span class="p">=</span> <span class="n">offenseComponent</span><span class="p">.</span><span class="n">BaseAim</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">num</span> <span class="p">=</span> <span class="n">_rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="p">+</span> <span class="n">aimModifier</span> <span class="p">+</span> <span class="n">aimMods</span> <span class="p">&gt;</span> <span class="m">50</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">removeEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">removeEntityId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has been removed from play!"</span><span class="p">);</span>

                <span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">-=</span> <span class="n">offenseComponent</span><span class="p">.</span><span class="n">BaseDamage</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="n">_unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">removeEntityId</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Of course that means that now I’m really looking hard at what kind of refactoring needs to happen because that thing is way too big. I’m seeing some patterns though and that will making straightening things out much easier.</p>

<h2 id="has-component">Has Component</h2>
<p>The first refactor I’m looking at is going to be a piece of logic I use a lot.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">HasDefense</span><span class="p">(</span><span class="n">Entity</span> <span class="n">target</span><span class="p">,</span> <span class="k">out</span> <span class="n">Defense</span> <span class="n">defCom</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">foundDefense</span> <span class="p">=</span> <span class="nf">HasComponent</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ComponentType</span><span class="p">.</span><span class="n">Defense</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">defICom</span><span class="p">);</span>
            <span class="n">defCom</span> <span class="p">=</span> <span class="p">(</span><span class="n">Defense</span><span class="p">)</span><span class="n">defICom</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">foundDefense</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">HasOffense</span><span class="p">(</span><span class="n">Entity</span> <span class="n">origin</span><span class="p">,</span> <span class="k">out</span> <span class="n">Offense</span> <span class="n">offCom</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">foundOffense</span> <span class="p">=</span> <span class="nf">HasComponent</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">ComponentType</span><span class="p">.</span><span class="n">Offense</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">offICom</span><span class="p">);</span>
            <span class="n">offCom</span> <span class="p">=</span> <span class="p">(</span><span class="n">Offense</span><span class="p">)</span><span class="n">offICom</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">foundOffense</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">HasComponent</span><span class="p">(</span><span class="n">Entity</span> <span class="n">entity</span><span class="p">,</span> <span class="n">ComponentType</span> <span class="n">type</span><span class="p">,</span> <span class="k">out</span> <span class="n">IComponent</span> <span class="n">component</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">entity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="k">out</span> <span class="n">component</span><span class="p">);;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>That shortens up TargetEntity a bit but better than that, it makes the return statements at the top much more clear.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntity</span><span class="p">(</span><span class="n">Entity</span> <span class="n">originEntity</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">targetEntity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">HasDefense</span><span class="p">(</span><span class="n">targetEntity</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">defenseComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">HasOffense</span><span class="p">(</span><span class="n">originEntity</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">offenseComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">aimMods</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">originEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">ComponentType</span><span class="p">.</span><span class="n">Inventory</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">inventoryIComponent</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">aimMods</span> <span class="p">=</span> <span class="nf">GetAimModifiers</span><span class="p">(</span><span class="n">inventoryIComponent</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">aimModifier</span> <span class="p">=</span> <span class="n">offenseComponent</span><span class="p">.</span><span class="n">BaseAim</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">num</span> <span class="p">=</span> <span class="n">_rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="p">+</span> <span class="n">aimModifier</span> <span class="p">+</span> <span class="n">aimMods</span> <span class="p">&gt;</span> <span class="m">50</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">removeEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">removeEntityId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has been removed from play!"</span><span class="p">);</span>

                <span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">-=</span> <span class="n">offenseComponent</span><span class="p">.</span><span class="n">BaseDamage</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="n">_unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">removeEntityId</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>



  <small>tags: <em>code</em> - <em>component</em> - <em>defense</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/roguelike/2021/11/14/hit-points.html">&#8672;&nbsp;Hit Points</a>
      
    </p>
    <p>
      
      <a href="/roguelike/2021/11/16/item-bonus.html">Item Damage Bonus&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>