<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Item Damage Bonus</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Item Damage Bonus | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Item Damage Bonus" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Time Still working on adding my Defense functionality. The next part I actually add is going to be the damage bonuses on the Weapon class and the calculations to figure it into actual damage dealing. Then maybe we take a look at items that either reduce damage, which is probably the same as the bonuses on the weapons but negative, and possibly ablative effects that reduce damage but cause wear on the item. I should probably take a quick look back at my plan, and of course I’m going a little more slowly right now because I’m looking at long and messy logic blocks and refactoring." />
<meta property="og:description" content="Time Still working on adding my Defense functionality. The next part I actually add is going to be the damage bonuses on the Weapon class and the calculations to figure it into actual damage dealing. Then maybe we take a look at items that either reduce damage, which is probably the same as the bonuses on the weapons but negative, and possibly ablative effects that reduce damage but cause wear on the item. I should probably take a quick look back at my plan, and of course I’m going a little more slowly right now because I’m looking at long and messy logic blocks and refactoring." />
<link rel="canonical" href="https://assumeforsimplicity.com/roguelike/2021/11/16/item-bonus.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/roguelike/2021/11/16/item-bonus.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-16T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Item Damage Bonus" />
<script type="application/ld+json">
{"description":"Time Still working on adding my Defense functionality. The next part I actually add is going to be the damage bonuses on the Weapon class and the calculations to figure it into actual damage dealing. Then maybe we take a look at items that either reduce damage, which is probably the same as the bonuses on the weapons but negative, and possibly ablative effects that reduce damage but cause wear on the item. I should probably take a quick look back at my plan, and of course I’m going a little more slowly right now because I’m looking at long and messy logic blocks and refactoring.","headline":"Item Damage Bonus","dateModified":"2021-11-16T09:11:34+00:00","datePublished":"2021-11-16T09:11:34+00:00","url":"https://assumeforsimplicity.com/roguelike/2021/11/16/item-bonus.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/roguelike/2021/11/16/item-bonus.html"},"author":{"@type":"Person","name":"jr101dallas"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Item Damage Bonus</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">16 November 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="time">Time</h1>
<p>Still working on adding my Defense functionality. The next part I actually add is going to be the damage bonuses on the Weapon class and the calculations to figure it into actual damage dealing. Then maybe we take a look at items that either reduce damage, which is probably the same as the bonuses on the weapons but negative, and possibly ablative effects that reduce damage but cause wear on the item. I should probably take a quick look back at my plan, and of course I’m going a little more slowly right now because I’m looking at long and messy logic blocks and refactoring.</p>

<h2 id="checking-plan">Checking Plan</h2>
<p>I skipped item damage bonuses in my plan. I don’t know how. But, here’s some code and tests for exactly that because I had it in mind the whole time even though I never actually wrote it.</p>

<p>First adjust Weapon.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Weapon</span> <span class="p">:</span> <span class="n">IItem</span><span class="p">,</span> <span class="n">IOffenseMods</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">BonusAim</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">BonusDamage</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>

        <span class="k">public</span> <span class="p">(</span><span class="kt">int</span> <span class="n">aimBonus</span><span class="p">,</span> <span class="kt">int</span> <span class="n">damageBonus</span><span class="p">)</span> <span class="nf">GetOffenseModifiers</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">BonusAim</span><span class="p">,</span> <span class="n">BonusDamage</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Then follow the change to tuple up the stack and include the damage bonus in the calculation.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntity</span><span class="p">(</span><span class="n">Entity</span> <span class="n">originEntity</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">targetEntity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">HasDefense</span><span class="p">(</span><span class="n">targetEntity</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">defenseComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">HasOffense</span><span class="p">(</span><span class="n">originEntity</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">offenseComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

            <span class="p">(</span><span class="kt">int</span> <span class="n">aimBonus</span><span class="p">,</span> <span class="kt">int</span> <span class="n">damageBonus</span><span class="p">)</span> <span class="n">offenseMods</span> <span class="p">=</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">HasInventory</span><span class="p">(</span><span class="n">originEntity</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">inventoryComponent</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">offenseMods</span> <span class="p">=</span> <span class="nf">GetItemModifiers</span><span class="p">(</span><span class="n">inventoryComponent</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">aimModifier</span> <span class="p">=</span> <span class="n">offenseComponent</span><span class="p">.</span><span class="n">BaseAim</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">num</span> <span class="p">=</span> <span class="n">_rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="p">+</span> <span class="n">aimModifier</span> <span class="p">+</span> <span class="n">offenseMods</span><span class="p">.</span><span class="n">aimBonus</span> <span class="p">&gt;</span> <span class="m">50</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">removeEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">removeEntityId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has been removed from play!"</span><span class="p">);</span>

                <span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">-=</span> <span class="n">offenseComponent</span><span class="p">.</span><span class="n">BaseDamage</span> <span class="p">+</span> <span class="n">offenseMods</span><span class="p">.</span><span class="n">damageBonus</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="n">_unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">removeEntityId</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>I’m not fond of declaring the tuple everywhere. It’s too long for one and going to get longer, but the ability to just name the items willy nilly and confuse things throughout the code smacks of magic strings. I’d thought for a bit that the tuples might be the way to go, and they might still be, inside my class of combat bonuses, but not just raw like they are now.</p>

<h2 id="testing">Testing</h2>
<p>The changes above caused some expected broken and failing tests, and that’s great. There were also a couple of needed new tests.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">WeaponBonusDamageIsFive</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">weapon</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">mods</span> <span class="p">=</span> <span class="n">weapon</span><span class="p">.</span><span class="nf">GetOffenseModifiers</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="n">mods</span><span class="p">.</span><span class="n">damageBonus</span><span class="p">,</span> <span class="s">"Weapon BonusDamage isn't the expected value."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">GetItemModifiersSumsAllDamage</span><span class="p">()</span>
        <span class="p">{</span>         
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">inv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Inventory</span><span class="p">();</span>
            <span class="c1">//inv.items.Add(1, new Weapon()); items[1] default hardcoded to Weapon</span>
            <span class="n">inv</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">());</span>
            <span class="n">inv</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">());</span>

            <span class="kt">var</span> <span class="n">mods</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="n">inf</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">GetItemModifiers</span><span class="p">(</span><span class="n">inv</span><span class="p">);</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="n">mods</span><span class="p">.</span><span class="n">damageBonus</span><span class="p">,</span> <span class="s">"aimModsTotal not expected value."</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>And that gets the Item damage bonuses in place.</p>



  <small>tags: <em>code</em> - <em>item</em> - <em>bonus</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/roguelike/2021/11/15/back-to-hp.html">&#8672;&nbsp;Back To HP</a>
      
    </p>
    <p>
      
      <a href="/roguelike/2021/11/17/adding-models.html">Adding Models&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>