<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Collision Work</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Collision Work | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Collision Work" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Remaining Items Work items remaining, after tests, side quests, and experiments, are the following." />
<meta property="og:description" content="Remaining Items Work items remaining, after tests, side quests, and experiments, are the following." />
<link rel="canonical" href="https://assumeforsimplicity.com/roguelike/2021/11/27/collision-work.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/roguelike/2021/11/27/collision-work.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-27T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Collision Work" />
<script type="application/ld+json">
{"description":"Remaining Items Work items remaining, after tests, side quests, and experiments, are the following.","headline":"Collision Work","dateModified":"2021-11-27T09:11:34+00:00","datePublished":"2021-11-27T09:11:34+00:00","url":"https://assumeforsimplicity.com/roguelike/2021/11/27/collision-work.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/roguelike/2021/11/27/collision-work.html"},"author":{"@type":"Person","name":"jr101dallas"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Collision Work</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">27 November 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="remaining-items">Remaining Items</h1>
<p>Work items remaining, after tests, side quests, and experiments, are the following.</p>

<ol>
  <li>implement a public ResolveCollision, probably taking an OffenseMods and an Entity for now, maybe overloads later</li>
  <li>implement the seam in Target.TargetEntity where the logic jumps to Collision</li>
</ol>

<p>It’s somewhat entertaining to me still that I have so many surprises, gaps in requirements, and gaps in design, but I console myself claiming that I spend very little time on writing the work items. It’s true, because I’m still writing requirements and work items for myself, but I’ll continue practicing at doing it quickly AND more completely. It certainly can’t hurt, and any gains will help here as well as in my real job.</p>

<h2 id="resolvecollision">ResolveCollision</h2>
<p>Kind of tackling both of the remaining items together, going to need to work in some tests in a minute. Collision.ResolveCollision ends up looking like the code below for the moment, and Target.TargetEntity is updated accordingly. This means I’m a whole lot happier with TargetEntity.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">ResolveCollision</span><span class="p">(</span><span class="n">OffenseMods</span> <span class="n">off</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">def</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">def</span><span class="p">.</span><span class="nf">HasDefense</span><span class="p">(</span><span class="k">out</span> <span class="kt">var</span> <span class="n">defenseComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">off</span><span class="p">.</span><span class="n">rngValue</span> <span class="p">+</span> <span class="n">off</span><span class="p">.</span><span class="n">totalAim</span> <span class="p">&gt;</span> <span class="m">50</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">-=</span> <span class="n">off</span><span class="p">.</span><span class="n">totalDamage</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">defenseComponent</span><span class="p">.</span><span class="n">CurrentHealth</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">def</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has been removed from play!"</span><span class="p">);</span>
                    <span class="n">_unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">def</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntity</span><span class="p">(</span><span class="n">Entity</span> <span class="n">originEntity</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">targetEntity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">num</span> <span class="p">=</span> <span class="n">_rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">offenseMods</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OffenseMods</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>
            <span class="n">offenseMods</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nf">GetEntityOffenseModifiers</span><span class="p">(</span><span class="n">originEntity</span><span class="p">));</span>
            
            <span class="n">_unv</span><span class="p">.</span><span class="n">inf</span><span class="p">.</span><span class="n">collision</span><span class="p">.</span><span class="nf">ResolveCollision</span><span class="p">(</span><span class="n">offenseMods</span><span class="p">,</span> <span class="n">targetEntity</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="collision-testing">Collision Testing</h2>
<p>All the tests are still passing folloing moving the logic to Collision. Good start. I think that the actual Collision tests may just be a Target test that gets moved, or possibly just stripped down to the smaller scope of code.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntityNotRemovedFromPlay</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">targetEntity</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">tEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>

            <span class="n">unv</span><span class="p">.</span><span class="n">inf</span><span class="p">.</span><span class="n">collision</span><span class="p">.</span><span class="nf">ResolveCollision</span><span class="p">(</span><span class="k">new</span> <span class="nf">OffenseMods</span><span class="p">(),</span> <span class="n">targetEntity</span><span class="p">);</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">IsTrue</span><span class="p">(</span><span class="n">unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">tEntityId</span><span class="p">,</span> <span class="k">out</span> <span class="n">_</span><span class="p">),</span> <span class="s">"Targeted Entity unexpectedly removed from play."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntityCurrentHealthIs45</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">targetEntity</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Entity</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">collision</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Collision</span><span class="p">(</span><span class="k">new</span> <span class="nf">Universe</span><span class="p">());</span>

            <span class="n">collision</span><span class="p">.</span><span class="nf">ResolveCollision</span><span class="p">(</span><span class="k">new</span> <span class="nf">OffenseMods</span><span class="p">(),</span> <span class="n">targetEntity</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">defense</span> <span class="p">=</span> <span class="p">(</span><span class="n">Defense</span><span class="p">)</span><span class="n">targetEntity</span><span class="p">.</span><span class="n">components</span><span class="p">[</span><span class="n">ComponentType</span><span class="p">.</span><span class="n">Defense</span><span class="p">];</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="n">defense</span><span class="p">.</span><span class="n">CurrentHealth</span><span class="p">,</span> <span class="s">"Entity has unexpected CurrentHealth"</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Stripped down tests is where I ended up. It’s actually a little funny since simplifying the test code might actually cause more code execution overall, but I’ll decide if I’m worried about that later. Maybe adding a simpler constructor to Collision that doesn’t need…. Nope, I just looked at that. The code references <code class="language-plaintext highlighter-rouge">_unv</code> to remove an Entity from play which could end up with a null refernce in my tests if I’m not careful.</p>



  <small>tags: <em>code</em> - <em>collision</em> - <em>system</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/roguelike/2021/11/26/random-value.html">&#8672;&nbsp;Random Value</a>
      
    </p>
    <p>
      
      <a href="/roguelike/2021/11/28/plan-filter.html">Plan Filter&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>