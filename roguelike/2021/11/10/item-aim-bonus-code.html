<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>Item Aim Bonus</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Item Aim Bonus | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Item Aim Bonus" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Work the Item Steps Coding time again. Steps repeated for convenience." />
<meta property="og:description" content="Work the Item Steps Coding time again. Steps repeated for convenience." />
<link rel="canonical" href="https://assumeforsimplicity.com/roguelike/2021/11/10/item-aim-bonus-code.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/roguelike/2021/11/10/item-aim-bonus-code.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-10T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Item Aim Bonus" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"jr101dallas"},"description":"Work the Item Steps Coding time again. Steps repeated for convenience.","headline":"Item Aim Bonus","dateModified":"2021-11-10T09:11:34+00:00","url":"https://assumeforsimplicity.com/roguelike/2021/11/10/item-aim-bonus-code.html","datePublished":"2021-11-10T09:11:34+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/roguelike/2021/11/10/item-aim-bonus-code.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>Item Aim Bonus</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">10 November 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="work-the-item-steps">Work the Item Steps</h1>
<p>Coding time again. Steps repeated for convenience.</p>

<ol>
  <li>create an interface for targeting bonuses, name tba</li>
  <li>create a class that implements IItem and IWhatsit, probably just Weapon for now</li>
  <li>create tests for both interfaces in WeaponTests</li>
  <li>swap out the Item being added to Inventory by default with the new class</li>
  <li>add a GetAimBonus or whatever to the new interface</li>
  <li>implement the logic for GetAimBonus in Weapon</li>
  <li>add test checking the default value of the bonus in Weapon</li>
  <li>add logic in Target to loop through entity items, sum the bonuses of the IWhatsit interface, and add to the calculation</li>
</ol>

<h2 id="iwhatsit">IWhatsit</h2>
<p>My Aim Component has BaseAim in it. I’m thinking that I’m naming the interface for bonuses to Aim IAimBonus. Well…. . Aim might eventually have damage amount and type in it and a corresponding name change, and it could be bonuses or penalties, but I would expect the same interface would also handle those things too. So, going with IAimMods.</p>

<p>Creating the Weapon class, implementing empty interfaces to start. Then I need the int for the… I did plan my tests first on purpose. So here are the basic interface tests on Weapon first.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IAimMods</span>
    <span class="p">{</span>  
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Weapon</span> <span class="p">:</span> <span class="n">IItem</span><span class="p">,</span> <span class="n">IAimMods</span>
    <span class="p">{</span>        
    <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultWeaponIsIItem</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">weapon</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">IsTrue</span><span class="p">(</span><span class="n">weapon</span> <span class="k">is</span> <span class="n">IItem</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultWeaponIsIAimMods</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">weapon</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">IsTrue</span><span class="p">(</span><span class="n">weapon</span> <span class="k">is</span> <span class="n">IAimMods</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Start simple, confirm the tests work, no typos or mistakes. Ok, tests are passing.</p>

<h2 id="aim-bonus">Aim Bonus</h2>
<p>Back to the int for the bonus, should be private, and the method in the interface and the implementation. Add the Test for the GetAimModifiers. I’m trying to lean harder into remembering the tests even in the planning. The value is so high that I think it’s well worth working to improve my habits.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IAimMods</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="nf">GetAimModifiers</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">Weapon</span> <span class="p">:</span> <span class="n">IItem</span><span class="p">,</span> <span class="n">IAimMods</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">BonusAim</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="nf">GetAimModifiers</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">BonusAim</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">WeaponBonusAimIsFive</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">weapon</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="n">weapon</span><span class="p">.</span><span class="nf">GetAimModifiers</span><span class="p">(),</span> <span class="s">"Weapon BonusAim isn't the expected value."</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="whoops">Whoops</h2>
<p>I skipped swapping out the default IItem in Inventory, so here’s that piece. And I’m probably fixing a test.</p>

<p>No test failures. I added a test so I won’t miss that in the future when I make changes to the hardcoding.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="nf">Inventory</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">items</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="k">new</span> <span class="nf">Weapon</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultInventoryItemOneIsWeapon</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">inventory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Inventory</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">firstItem</span> <span class="p">=</span> <span class="n">inventory</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Weapon</span><span class="p">),</span> <span class="n">firstItem</span><span class="p">.</span><span class="nf">GetType</span><span class="p">(),</span> <span class="s">"First item wasn't Type Weapon."</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="calculating-aim-modifiers">Calculating Aim Modifiers</h2>
<p>Last piece here is to plumb in the references and calculation to actually apply the motifiers to the targeting.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">TargetEntity</span><span class="p">(</span><span class="n">Entity</span> <span class="n">originEntity</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">targetEntity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">originEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"Aim"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">aimIComponent</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">aimMods</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">originEntity</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="s">"Inventory"</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">inventoryIComponent</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">aimMods</span> <span class="p">=</span> <span class="nf">GetAimModifiers</span><span class="p">(</span><span class="n">inventoryIComponent</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">aimComponent</span> <span class="p">=</span> <span class="p">(</span><span class="n">Aim</span><span class="p">)</span><span class="n">aimIComponent</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">aimModifier</span> <span class="p">=</span> <span class="n">aimComponent</span><span class="p">.</span><span class="n">BaseAim</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">num</span> <span class="p">=</span> <span class="n">_rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="p">+</span> <span class="n">aimModifier</span> <span class="p">+</span> <span class="n">aimMods</span> <span class="p">&gt;</span> <span class="m">50</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">removeEntityId</span> <span class="p">=</span> <span class="n">targetEntity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Entity </span><span class="p">{</span><span class="n">removeEntityId</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()}</span><span class="s"> has been removed from play!"</span><span class="p">);</span>
                <span class="n">_unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">removeEntityId</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="nf">GetAimModifiers</span><span class="p">(</span><span class="n">IComponent</span> <span class="n">inventoryIComponent</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Inventory</span><span class="p">)</span> <span class="p">!=</span> <span class="n">inventoryIComponent</span><span class="p">.</span><span class="nf">GetType</span><span class="p">())</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">aimMods</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">inv</span> <span class="p">=</span> <span class="p">(</span><span class="n">Inventory</span><span class="p">)</span><span class="n">inventoryIComponent</span><span class="p">;</span>

            <span class="k">foreach</span><span class="p">(</span><span class="n">IItem</span> <span class="n">item</span> <span class="k">in</span> <span class="n">inv</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">Values</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="k">is</span> <span class="n">IAimMods</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">modItem</span> <span class="p">=</span> <span class="p">(</span><span class="n">IAimMods</span><span class="p">)</span><span class="n">item</span><span class="p">;</span>
                    <span class="n">aimMods</span> <span class="p">+=</span> <span class="n">modItem</span><span class="p">.</span><span class="nf">GetAimModifiers</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">aimMods</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">GetAimModifiersSumsAll</span><span class="p">()</span>
        <span class="p">{</span>         
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">inv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Inventory</span><span class="p">();</span>
            <span class="c1">//inv.items.Add(1, new Weapon()); items[1] default hardcoded to Weapon</span>
            <span class="n">inv</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">());</span>
            <span class="n">inv</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Weapon</span><span class="p">());</span>

            <span class="kt">var</span> <span class="n">aimModsTotal</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="n">inf</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">GetAimModifiers</span><span class="p">(</span><span class="n">inv</span><span class="p">);</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">15</span><span class="p">,</span> <span class="n">aimModsTotal</span><span class="p">,</span> <span class="s">"aimModsTotal not expected value."</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>And, yes, that was more code than I’d really meant to have in a single step. Also, there’s definitely more than one thing going on in TargetEntity so there’s some refactoring that’s going to need to happen. The Summary system I was thinking of would probably help sort out some of the complication in there.</p>



  <small>tags: <em>code</em> - <em>item</em> - <em>component</em> - <em>target</em> - <em>bonus</em> - <em>aim</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/roguelike/2021/11/09/item-aim-bonus.html">&#8672;&nbsp;Item Aim Bonus</a>
      
    </p>
    <p>
      
      <a href="/roguelike/2021/11/11/picking-up.html">Picking Up Notes&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>