<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <title>SortedList Extensions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="https://assumeforsimplicity.com/feed.xml" title="Assume For Simplicity" />
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>SortedList Extensions | Assume For Simplicity</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="SortedList Extensions" />
<meta name="author" content="jr101dallas" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Reversal So I changed my mind a bit. I was just planning on using a Dictionary again in Universe for tracking Entity instances just like I’m using on the Dictionary in Entity to track Components in Entity. But, I found that because I was using Entity.Id for the Key, which is an int, and because I really wanted to be able to grab Last() on the Key of the Dictionary of Entity instances so that I knew the next Entity.Id to create in the factory, I went looking to see if I could find something I liked better." />
<meta property="og:description" content="Reversal So I changed my mind a bit. I was just planning on using a Dictionary again in Universe for tracking Entity instances just like I’m using on the Dictionary in Entity to track Components in Entity. But, I found that because I was using Entity.Id for the Key, which is an int, and because I really wanted to be able to grab Last() on the Key of the Dictionary of Entity instances so that I knew the next Entity.Id to create in the factory, I went looking to see if I could find something I liked better." />
<link rel="canonical" href="https://assumeforsimplicity.com/roguelike/2021/10/27/sortedlist=extensions.html" />
<meta property="og:url" content="https://assumeforsimplicity.com/roguelike/2021/10/27/sortedlist=extensions.html" />
<meta property="og:site_name" content="Assume For Simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-27T09:11:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SortedList Extensions" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"jr101dallas"},"description":"Reversal So I changed my mind a bit. I was just planning on using a Dictionary again in Universe for tracking Entity instances just like I’m using on the Dictionary in Entity to track Components in Entity. But, I found that because I was using Entity.Id for the Key, which is an int, and because I really wanted to be able to grab Last() on the Key of the Dictionary of Entity instances so that I knew the next Entity.Id to create in the factory, I went looking to see if I could find something I liked better.","headline":"SortedList Extensions","dateModified":"2021-10-27T09:11:34+00:00","url":"https://assumeforsimplicity.com/roguelike/2021/10/27/sortedlist=extensions.html","datePublished":"2021-10-27T09:11:34+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://assumeforsimplicity.com/roguelike/2021/10/27/sortedlist=extensions.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">
        <nav>
    
      <a href="/" >
        Home
      </a>
    
      <a href="/posts/" >
        Posts
      </a>
    
      <a href="/breadcrumbs/" >
        Breadcrumbs
      </a>
    
      <a href="/roguelike-tutorial/" >
        Roguelike
      </a>
    
      <a href="/about/" >
        About
      </a>
    
  </nav>
        <header>
          <h1>SortedList Extensions</h1>
          <h2>Manage Time, Software, and Business, Easily  </h2>
        </header>
        <section id="downloads" class="clearfix">
          
	
        </section>
        <hr>
        <section id="main_content">
          <p class="view">27 October 2021 by jr101dallas</p>
<a href="/posts/">&#8672;&nbsp;Back to Posts</a>


<h1 id="reversal">Reversal</h1>
<p>So I changed my mind a bit. I was just planning on using a Dictionary again in Universe for tracking Entity instances just like I’m using on the Dictionary in Entity to track Components in Entity. But, I found that because I was using Entity.Id for the Key, which is an int, and because I really wanted to be able to grab Last() on the Key of the Dictionary of Entity instances so that I knew the next Entity.Id to create in the factory, I went looking to see if I could find something I liked better.</p>

<h2 id="research-and-decisions">Research and Decisions</h2>
<p>The use cases are close-ish, but I expect to maybe have thousands of Entity instances and they’re easily ordered. I only expect to maybe have dozens of Component instances on an Entity and I expect to have the string be a name that I can easily refer to (maybe eventually an Enum) so they’re not really all the way close. The search for the Last() function got me into the right place eventually. I found this link on <a href="https://stackoverflow.com/questions/1613004/get-last-element-in-a-sorteddictionary">StackOverflow</a> about SortedDictionary and eventually landed on a SortedList with the extension methods suggested. So, Universe actually looks like this now.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Universe</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">SortedList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">IEntity</span><span class="p">&gt;</span> <span class="n">entities</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SortedList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">IEntity</span><span class="p">&gt;();</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="nf">LastEntityId</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">entities</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span>

            <span class="k">return</span> <span class="n">entities</span><span class="p">.</span><span class="nf">Max</span><span class="p">().</span><span class="n">Key</span><span class="p">;</span>
        <span class="p">}</span>        

        <span class="k">public</span> <span class="n">Entity</span> <span class="nf">GetEntity</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">ef</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EntityFactory</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">entity</span> <span class="p">=</span> <span class="n">ef</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">(</span><span class="nf">LastEntityId</span><span class="p">());</span>
            <span class="n">entities</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">entity</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>The extension methods are as described in the link with links back to the post in comments. I figure it’s best to leave a link in there for documentation of somebody else’s cleverness and work.</p>

<h2 id="and-testing">And Testing</h2>
<p>I also started getting my tests filled in again. It’s definitely becoming clear that I’m working through a draft of the real tutorial. Working out details and finding my way through the actual code while working my method and checking if it works. I’m much more in teh middle of things than I want to be but it’s not clear to me at the moment how I can break it into smaller functional chunks.</p>

<p>These tests helped me find a bug:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultUniverseHasZeroEntities</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">DefaultUniverseLastEntityIdIsZero</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">unv</span><span class="p">.</span><span class="nf">LastEntityId</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">FirstEntityHasIdOne</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">ent1</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">ent1</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
        <span class="p">}</span> 

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">FirstEntityAddsToEntitiesCount</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">ent1</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">unv</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
        <span class="p">}</span> 

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">SecondEntityGivesLastEntityIdTwo</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">ent1</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">ent2</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="n">unv</span><span class="p">.</span><span class="nf">LastEntityId</span><span class="p">());</span>
        <span class="p">}</span> 

        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">FirstEntityRetrivedAfterSecondEntityCreated</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">unv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Universe</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">ent1</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">ent2</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">entityRetrieved</span> <span class="p">=</span> <span class="n">unv</span><span class="p">.</span><span class="n">entities</span><span class="p">[</span><span class="n">ent1</span><span class="p">.</span><span class="n">Id</span><span class="p">];</span>

            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="n">ent1</span><span class="p">,</span> <span class="n">entityRetrieved</span><span class="p">);</span>
        <span class="p">}</span> 
</code></pre></div></div>

<p>The bug was here:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">class</span> <span class="nc">EntityFactory</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Entity</span> <span class="nf">GetEntity</span><span class="p">(</span><span class="kt">int</span> <span class="n">lastEntityId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">Entity</span><span class="p">(){</span>
                <span class="c1">//Id = lastEntityId++</span>
                <span class="n">Id</span> <span class="p">=</span> <span class="p">++</span><span class="n">lastEntityId</span>
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>That really got me wondering how I’d never really caught the difference before and how many times I’ve just been lucky with code using the increment operator.</p>

<p>Maybe it was this test that was the actual one that I caught my problem on. The fact that I don’t remember which is part and parcel with the fact and reason that I’m annoyed that I haven’t managed to break this down smaller. On the whole, I don’t think it’s causing me a big problem but there’s enough going on that it could have been. I’m lucky I’m in a good working streak and not in the middle of the holidays. Can’t complain about good luck, but can’t rely on it either.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">[</span><span class="n">TestClass</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">EntityFactoryTests</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">GetEntityZeroGivesIdOne</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">ef</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">EntityFactory</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">entity</span> <span class="p">=</span> <span class="n">ef</span><span class="p">.</span><span class="nf">GetEntity</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>



  <small>tags: <em>code</em> - <em>sortedlist</em> - <em>extensions</em> - <em>research</em></small>


<p>
  <div class="post-nav">
    <p>
      
      <a href="/roguelike/2021/10/26/entity-factory.html">&#8672;&nbsp;Entity Factory (Code)</a>
      
    </p>
    <p>
      
      <a href="/roguelike/2021/10/28/target-system-code.html">Target System Code&nbsp;&#8674;</a>
      
    </p>
  </div>
</p>
        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>